---
title: "Happiness"
author: "C'Asha Faltz"
date: "4/6/2020"
output: pdf_document
editor_options: 
  chunk_output_type: console
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(
	echo = TRUE,
	message = FALSE,
	warning = FALSE,
	comment = NULL
)
```


```{r}
library(purrr)
setwd("/Users/cashafaltztest/Documents")
files <- dir("Happiness/", pattern = "\\.csv$", full.names = TRUE)
happy_tbl <- map(files, read.csv)

```

```{r}
library(dplyr)
Y15 <- happy_tbl[[1]]
Y16 <- happy_tbl[[2]]
Y17 <- happy_tbl[[3]]
Y18 <- happy_tbl[[4]]
Y19 <- happy_tbl[[5]]

#Removed NA UAE Trust Value, Will add back after merge
Y18 <- Y18 %>% filter(Country.or.region != "United Arab Emirates")
Y18 <- Y18 %>% mutate(Perceptions.of.corruption = as.numeric(as.character(Perceptions.of.corruption)))

```

```{r function}
#functions for Y15 - Y17
create_data_frame <- function(dataset, YEAR){
  dataset <- dataset %>% 
  dplyr::select(Country, Happiness.Rank, Economy..GDP.per.Capita., Family, Health..Life.Expectancy., Freedom,
                Trust..Government.Corruption., Generosity)
  colnames(dataset) <- c("Country", "Happiness_Rank", "Economy", "Support", "Health", "Freedom", "Trust", "Generosity")
  dataset <- dataset %>% mutate(Year = YEAR) %>%  
    dplyr::select(Happiness_Rank, Year, Country, everything()) 
  return(dataset)
}
#functions for Y18 - Y19
create_data_frame_2 <- function(dataset, YEAR){
  dataset <- dataset %>% 
  dplyr::select(-Score) %>% dplyr::select(2,1,3:6,8,7)
  colnames(dataset) <- c("Country", "Happiness_Rank", "Economy", "Support", "Health", "Freedom", "Trust", "Generosity")
  dataset <- dataset %>% mutate(Year = YEAR) %>%  
    dplyr::select(Happiness_Rank, Year, Country, everything()) 
  return(dataset)
}
```

```{r Clean Data Frames}
Year_2015 <- create_data_frame(dataset = Y15, YEAR = 2015)
head(Year_2015)

Year_2016 <- create_data_frame(dataset = Y16, YEAR = 2016)
head(Year_2016)

Year_2017 <- create_data_frame(dataset = Y17, YEAR = 2017)
head(Year_2017)

Year_2018 <- create_data_frame_2(dataset = Y18, YEAR = 2018)
head(Year_2018)

Year_2019 <- create_data_frame_2(dataset = Y19, YEAR = 2019)
head(Year_2019)
```


```{r Merge Years}
Year2015_2019 <- bind_rows(Year_2015, Year_2016, Year_2017, Year_2018, Year_2019)
Year2015_2019 <- Year2015_2019 %>% arrange(Country)
#fixed missing Trust value for UAE in 2018 by using the mean of other years

UAE_Trust_18 <- Year2015_2019 %>% filter(Country == "United Arab Emirates") %>% summarise(Trust = mean(Trust))

UAE <- data.frame("Happiness_Rank" = 20, "Year" = 2018, "Country" = "United Arab Emirates", "Economy" = 	6.774, "Support" = 2.096, 
"Health" = 0.776, "Freedom" = 0.284, "Trust" = UAE_Trust_18, "Generosity" = 0.186)

#attached UAE18
Year2015_2019 <- bind_rows(Year2015_2019, UAE)
Year2015_2019 <- Year2015_2019 %>% group_by(Country) %>%  arrange(Year)
#save data to csv
write.csv(Year2015_2019, "Clean_Happiness_Data.csv", row.names = F)
```

